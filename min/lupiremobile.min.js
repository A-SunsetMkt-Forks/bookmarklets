javascript:krazete:function choose(a){return a[Math.floor(Math.random()*a.length)]}function newHex(c,d){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=16);for(var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],f="#",g=0;6>g;g++)f+=choose(e.slice(c,d));return f}function newByte(c,d,e){"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=256);for(var f=[],g=0;256>g;g++)f.push(g);var h="rgba(";for(g=0;3>g;g++)h+=choose(f.slice(d,e))+",";return h+=c+")",h}function newBlock(a){for(var b=[0,1,2,2,3,3,3,3,4,4,5,5],c=[],d=0;d<blocks.length;d++)for(var e=0;e<a[b[d]];e++)c.push(blocks[d]);return choose(c)}var blocks=[full={img:1,goto:[0,1,2,3]},empty={img:0,goto:[2,3,0,1]},bslash={img:1,goto:[1,0,3,2]},slash={img:0,goto:[3,2,1,0]},cornertr={img:[1,1,0,0],goto:[0,1,3,2]},cornerbr={img:[1,0,0,1],goto:[0,2,1,3]},cornerbl={img:[0,0,1,1],goto:[1,0,2,3]},cornertl={img:[0,1,1,0],goto:[3,1,2,0]},vpipe={img:[1,0,1,0],goto:[0,3,2,1]},hpipe={img:[0,1,0,1],goto:[2,1,0,3]},ccw={img:1,goto:[1,2,3,0]},cw={img:0,goto:[3,0,1,2]}],spinster=document.createElement("style");spinster.innerHTML="@keyframes cwise{ from{transform:rotate(0deg);-webkit-transform:rotate(0deg);} to{transform:rotate(360deg);-webkit-transform:rotate(360deg);} }",spinster.innerHTML+="@keyframes ccwise{ from{transform:rotate(360deg);-webkit-transform:rotate(360deg);} to{transform:rotate(0deg);-webkit-transform:rotate(0deg);} }",document.body.appendChild(spinster);var span=3,distribution=[0,2,1,0,0,0],VMIN=innerWidth<innerHeight?innerWidth:innerHeight,zoom=3*VMIN/4,unit=zoom/span,speed=.1,game=document.createElement("div");game.style.position="fixed",game.style.top="50%25",game.style.left="50%25",game.style.transform="translate(-50%25,-50%25)",game.style.webkitTransform="translate(-50%25,-50%25)",game.style.transition=speed+"s opacity",game.style.zIndex="9999";var compass,edges,goal,ball,corners=document.getElementsByClassName("cornerBox"),inners=document.getElementsByClassName("innerBox"),rawEdges=document.getElementsByClassName("edgeBox"),lvl=1,pts=0,hp=15,board=document.createElement("div");board.style.background="white",board.style.textAlign="center",board.style.position="fixed",board.style.bottom=0,board.style.left="50%25",board.style.transform="translateX(-50%25)",board.style.webkitTransform="translateX(-50%25)",board.style.transition=speed+"s opacity",board.style.border="1px solid black",board.style.padding="5px",board.style.borderRadius="5px",board.style.zIndex="9999",document.body.appendChild(board);var tab=" &shy; &shy; &shy; &shy; &shy; &shy; &shy; &shy; &shy; ";function newGame(a,b,c,e){if("undefined"==typeof a&&(a=span),span=a,"undefined"==typeof b&&(b=distribution),distribution=b,"undefined"==typeof c&&(c=zoom),zoom=c,unit=zoom/span,"undefined"==typeof e&&(e=speed),speed=e,board.style.opacity=1,board.innerHTML="Lives: "+hp+tab+"Points: "+pts+tab+"Level: "+(span-2)+tab+"Sublevel: "+lvl+"/"+(span-2)+"</br>",0==hp||2==span)return hide(),disable(),ball.remove(),board.innerHTML+="GAME OVER",0;for(;game.lastChild;)game.removeChild(game.lastChild);for(game.remove(),game.style.background=newByte(3/4,64,192),game.style.height=zoom+"px",game.style.width=zoom+"px",game.style.borderRadius=1/2*unit+"px",game.style.opacity=1,document.body.appendChild(game),compass=newBoard(),edges=[],i=0;i<rawEdges.length;i++)rawEdges[i].end=newPath(rawEdges[i].x,rawEdges[i].y),edges.push(rawEdges[i]);edges.sort(function(c,a){return c.end.steps-a.end.steps}),setTimeout(setUp,1e4*speed*(1+span/10))}function setUp(){goal=newGoal(),ball=newBall(goal.x,goal.y),hide(),enable()}function newBoard(){for(var a=newHex(0,8),c=[],d=[],e=0;e<span;e++){c[e]=[],d[e]=[];for(var f,g=0;g<span;g++){f=document.createElement("div"),f.style.height=unit+"px",f.style.width=unit+"px",f.style.position="absolute",f.style.top=e*unit+"px",f.style.left=g*unit+"px",f.style.boxSizing="border-box",f.style.boxShadow="inset 0 0 3px "+game.style.backgroundColor,game.appendChild(f);var h=document.createElement("div");if(h.x=e,h.y=g,h.style.position="absolute",h.style.top=e*unit+"px",h.style.left=g*unit+"px",h.style.boxSizing="border-box",(0!=e||0!=g)&&(0!=e||g!=span-1)&&(e!=span-1||g!=span-1)&&(e!=span-1||0!=g))0==e||e==span-1||0==g||g==span-1?(0==e||e==span-1?(c[e][g]=blocks[8],d[e][g]=0==e?[3,3,3,3]:[1,1,1,1]):(0==g||g==span-1)&&(c[e][g]=blocks[9],d[e][g]=0==g?[0,0,0,0]:[2,2,2,2]),h.className="edgeBox",h.style.background="rgba(0,0,0,0.25)",h.style.transition=2*speed+"s background"):(c[e][g]=newBlock(distribution),d[e][g]=c[e][g].goto,h.className="innerBox",h.style.borderRadius="33.333333333333336%25",h.style.transition=2*speed+"s opacity");else if(f.remove(),c[e][g]=blocks[0],d[e][g]="X",h.className="cornerBox",h.style.transition=speed+"s border-radius",0==e&&0==g)h.style.borderTopLeftRadius="50%25",h.setAttribute("onMouseOver","this.style.borderTopLeftRadius='25%25'"),h.setAttribute("onMouseOut","this.style.borderTopLeftRadius='50%25'"),h.setAttribute("onClick","newGame()");else if(0==e&&g==span-1){var k=document.createElement("div");k.style.background="white",k.style.height=1/2*unit+"px",k.style.width=1/10*unit+"px",k.style.borderRadius="33.333333333333336%25",k.style.position="absolute",k.style.top=1/4*unit+"px",k.style.left=9/20*unit+"px",k.style.transform="rotate(45deg)",k.style.webkitTransform="rotate(45deg)",h.appendChild(k);var l=k.cloneNode();l.style.transform="rotate(-45deg)",l.style.webkitTransform="rotate(-45deg)",h.appendChild(l),h.style.borderTopRightRadius="50%25",h.setAttribute("onMouseOver","this.style.borderTopRightRadius='25%25'"),h.setAttribute("onMouseOut","this.style.borderTopRightRadius='50%25'"),h.setAttribute("onClick","game.style.opacity=0;board.style.opacity=0;setTimeout(function(){ game.remove(); board.remove(); },100)")}else e==span-1&&g==span-1?(h.style.borderBottomRightRadius="50%25",h.setAttribute("onMouseOver","this.style.borderBottomRightRadius='25%25'"),h.setAttribute("onMouseOut","this.style.borderBottomRightRadius='50%25'"),h.setAttribute("onClick","hide()")):e==span-1&&0==g&&(h.style.borderBottomLeftRadius="50%25",h.setAttribute("onMouseOver","this.style.borderBottomLeftRadius='25%25'"),h.setAttribute("onMouseOut","this.style.borderBottomLeftRadius='50%25'"),h.setAttribute("onClick","show()"));var m=c[e][g],n="innerBox"==h.className?"white":a;m==full||m==empty?(h.style.background=m.img?n:"transparent",h.style.height=unit+"px",h.style.width=unit+"px"):m==bslash||m==slash?(h.style.background=n,h.style.left=(g+2/5)*unit+"px",h.style.height=unit+"px",h.style.width=1/5*unit+"px",h.style.transform="rotate("+[45,-45][m.img]+"deg)",h.style.webkitTransform="rotate("+[45,-45][m.img]+"deg)"):m==cornertr||m==cornerbr||m==cornerbl||m==cornertl?(h.style.height=unit+"px",h.style.width=unit+"px",h.style.borderRight=1/2*unit+"px solid "+(m.img[0]?n:"transparent"),h.style.borderTop=1/2*unit+"px solid "+(m.img[1]?n:"transparent"),h.style.borderLeft=1/2*unit+"px solid "+(m.img[2]?n:"transparent"),h.style.borderBottom=1/2*unit+"px solid "+(m.img[3]?n:"transparent")):m==vpipe||m==hpipe?(h.style.height=unit+"px",h.style.width=unit+"px",h.style.borderRight=1/5*unit+"px solid "+(m.img[0]?n:"transparent"),h.style.borderTop=1/5*unit+"px solid "+(m.img[1]?n:"transparent"),h.style.borderLeft=1/5*unit+"px solid "+(m.img[2]?n:"transparent"),h.style.borderBottom=1/5*unit+"px solid "+(m.img[3]?n:"transparent")):m==ccw||m==cw?(h.style.background=n,h.style.left=(g+2/5)*unit+"px",h.style.height=unit+"px",h.style.width=1/5*unit+"px",h.style.animation=["cwise","ccwise"][m.img]+" "+5*speed+"s infinite linear"):console.log("Error: Unknown block entered into display()."),game.appendChild(h)}}return d}function newPath(a,b,c,d){"undefined"==typeof c&&(c=compass[a][b][0]),"undefined"==typeof d&&(d=0);var e=compass[a][b][c],f=[[0,1],[-1,0],[0,-1],[1,0]];return a+=f[e][0],b+=f[e][1],0!=a&&a!=span-1&&0!=b&&b!=span-1?newPath(a,b,(e+2)%254,compass[a][b]==empty.goto?d+1:d+2):{x:a,y:b,steps:d}}function newBall(a,b){var c=document.createElement("div");return c.style.background="white",c.style.position="absolute",c.style.top=a*unit+"px",c.style.left=b*unit+"px",c.style.width=2/5*unit+"px",c.style.height=2/5*unit+"px",c.style.borderRadius="50%25",c.style.margin=3/10*unit+"px",c.style.transition=speed+"s top, "+speed+"s left, "+speed+"s background",c.style.transitionTimingFunction="linear",c.style.pointerEvents="none",game.appendChild(c),c}function move(a,b,c,d,e){"undefined"==typeof e&&(e=compass[c][d][0]),0<c&&c<span-1&&0<d&&d<span-1&&(getByXY(c,d).style.opacity=1);var f=compass[c][d][e],g=[[0,1],[-1,0],[0,-1],[1,0]];if(c+=g[f][0],d+=g[f][1],ball.style.top=unit*c+"px",ball.style.left=unit*d+"px",0!=c&&c!=span-1&&0!=d&&d!=span-1)setTimeout(function(){move(a,b,c,d,(f+2)%254)},1e3*speed);else{if(goal.end.x==a&&goal.end.y==b){for(var h=0;h<edges.length;h++)edges[h].style.background="rgba(0,128,0,0.5)";ball.style.background="green",pts+=goal.end.steps,lvl==span-2?(span++,lvl=1):lvl++}else{for(var h=0;h<edges.length;h++)edges[h].style.background="rgba(128,0,0,0.5)";ball.style.background="red",hp--,3<span&&(1==lvl?(span--,lvl=span-2):lvl--)}setTimeout(show,1e4*speed),setTimeout(newGame,2e4*speed)}}function getByXY(a,b){for(var c=0;c<inners.length;c++)if(inners[c].x==a&&inners[c].y==b)return inners[c]}function hide(){for(var a=0;a<inners.length;a++)inners[a].style.opacity=0}function show(){for(var a=0;a<inners.length;a++)inners[a].style.opacity=1}function newGoal(){for(var a={},b=0;b<edges.length;b++)null==a[edges[b].end.steps]?a[edges[b].end.steps]=[edges[b]]:a[edges[b].end.steps].push(edges[b]);return key=Object.keys(a),choose(a[key[key.length-1]])}function enable(){for(var a=0;a<edges.length;a++)edges[a].style.background="transparent",edges[a].setAttribute("onMouseOver","this.style.background='rgba(0,0,0,0.25)'"),edges[a].setAttribute("onMouseOut","this.style.background='transparent'"),edges[a].setAttribute("onClick","guess("+goal.x+","+goal.y+","+edges[a].x+","+edges[a].y+")")}function disable(){for(var a=0;a<edges.length;a++)edges[a].style.background="rgba(0,0,0,0.25)",edges[a].removeAttribute("onMouseOver"),edges[a].removeAttribute("onMouseOut"),edges[a].removeAttribute("onClick")}function guess(a,b,c,d){disable(),move(c,d,a,b)}newGame();